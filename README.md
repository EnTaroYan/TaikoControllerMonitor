# ESP32 八路示波器上位机

这是一个用Python编写的示波器上位机程序，用于接收ESP32发送的8路数据并实时显示波形。

## 功能特点

- 🔌 自动扫描和选择COM端口
- ⚙️ 可配置串口参数（波特率）
- 📊 同时显示8路波形数据
- 🎨 每路波形使用不同颜色显示
- 📈 实时数据更新（支持高采样率）
- 🧹 数据清除功能
- 📱 现代化的用户界面

## 安装依赖

首先确保您已安装Python 3.7或更高版本，然后安装所需的依赖包：

```bash
pip install -r requirements.txt
```

或者手动安装：

```bash
pip install pyserial PyQt5 pyqtgraph numpy
```

## 数据格式

ESP32发送的数据包格式：
```
value1,value2,value3,value4,value5,value6,value7,value8\r\n
```

- 8个int16类型的数据（范围：-32768 到 32767）
- 使用逗号分隔
- 以`\r\n`结尾

### 示例数据包
```
1024,-512,2048,-1024,512,-256,128,-64\r\n
```

## 使用方法

1. **启动程序**
   ```bash
   python oscilloscope.py
   ```

2. **连接ESP32**
   - 将ESP32连接到电脑的USB端口
   - 在程序中点击"刷新"按钮扫描可用端口
   - 选择对应的COM端口
   - 选择波特率（默认115200）
   - 点击"连接"按钮

3. **查看波形**
   - 连接成功后，8路波形将实时显示
   - 每路波形使用不同颜色区分
   - 可以调整显示点数（100-5000点）

4. **断开连接**
   - 点击"断开"按钮停止数据接收

## ESP32测试代码

项目中包含了一个ESP32测试程序`esp32_test_sender.ino`，它会生成8路不同的测试波形：

1. 通道1：正弦波
2. 通道2：余弦波  
3. 通道3：方波
4. 通道4：三角波
5. 通道5：锯齿波
6. 通道6：随机噪声
7. 通道7：低频正弦波
8. 通道8：高频正弦波

### 上传测试代码到ESP32

1. 在Arduino IDE中打开`esp32_test_sender.ino`
2. 选择正确的开发板和端口
3. 上传代码到ESP32
4. 打开串口监视器确认数据正常发送

## 程序界面说明

### 左侧控制面板
- **端口选择**：显示所有可用的串口，点击刷新更新列表
- **波特率设置**：支持常用波特率（9600, 115200, 230400, 460800, 921600）
- **连接状态**：显示当前连接状态
- **显示设置**：调整显示的数据点数
- **清除数据**：清空所有波形显示

### 右侧波形显示
- 8个独立的波形显示区域
- 每个通道使用不同颜色
- X轴：时间（采样点）
- Y轴：幅值（-32768 到 32767）
- 支持网格显示

## 性能优化

- 使用多线程接收串口数据，避免界面卡顿
- 采用缓冲队列存储数据，支持高速数据流
- 智能的数据解析，自动处理不完整的数据包
- 可配置的显示点数，平衡性能和显示效果

## 故障排除

### 1. 无法找到串口
- 确认ESP32已正确连接到电脑
- 检查驱动程序是否已安装
- 点击"刷新"按钮重新扫描端口

### 2. 连接失败
- 检查端口是否被其他程序占用
- 确认波特率设置正确
- 尝试不同的波特率

### 3. 无数据显示
- 检查ESP32是否正在发送数据
- 确认数据格式是否正确
- 查看程序控制台是否有错误信息

### 4. 波形显示异常
- 检查发送的数据是否在int16范围内
- 确认数据包格式正确（8个数字，逗号分隔，\r\n结尾）
- 尝试清除数据重新开始

## 自定义修改

### 修改通道数量
如需支持不同数量的通道，需要修改以下部分：
1. `OscilloscopeWidget`中的通道数量
2. `DataReceiver`中的数据解析逻辑
3. ESP32发送代码中的数据数量

### 修改数据格式
如需支持不同的数据格式，需要修改`DataReceiver._parse_data_packet`方法。

### 添加数据保存功能
可以在`OscilloscopeMainWindow`中添加数据记录和保存功能。

## 技术规格

- **支持系统**：Windows, Linux, macOS
- **Python版本**：3.7+
- **最大采样率**：取决于串口波特率和数据处理能力
- **最大显示点数**：5000点
- **数据精度**：16位整数
- **通道数量**：8路

## 许可证

本项目采用MIT许可证，详见LICENSE文件。

## 贡献

欢迎提交问题和改进建议！
